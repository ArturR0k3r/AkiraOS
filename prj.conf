###############################################################################
# AkiraOS Main Configuration
# Universal settings for all platforms - board-specific in boards/*.conf
###############################################################################

###############################################################################
# Core Peripherals (common to all platforms)
###############################################################################
CONFIG_GPIO=y
CONFIG_PINCTRL=y

###############################################################################
# Kernel & Threads
###############################################################################
# v1.3.4: Stack sizes depend on board profile (set in boards/*.conf):
#   MINIMAL:  MAIN=1536, SHELL=1536, ISR=1024
#   BALANCED: MAIN=2048, SHELL=2048, ISR=1536 (default)
#   FULL:     MAIN=3072, SHELL=3072, ISR=2048
#
# v1.3.6: Increased SYSTEM_WORKQUEUE to 2048 (WiFi/BLE require larger stack)
# Below are BALANCED defaults - board configs override for other profiles
CONFIG_MAIN_STACK_SIZE=2048
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048
CONFIG_SHELL_STACK_SIZE=2048
CONFIG_ISR_STACK_SIZE=1536
CONFIG_IDLE_STACK_SIZE=256
CONFIG_DYNAMIC_THREAD=y
CONFIG_DYNAMIC_THREAD_ALLOC=y
CONFIG_KERNEL_MEM_POOL=y
CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_SYS_HEAP_RUNTIME_STATS=y
CONFIG_THREAD_MONITOR=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_STACK_INFO=y

# State Machine Framework (needed by OCRE)
CONFIG_SMF=y
CONFIG_SMF_ANCESTOR_SUPPORT=y
CONFIG_SMF_INITIAL_TRANSITION=y

# Runtime Statistics
CONFIG_STATS=y
CONFIG_STATS_NAMES=y

# Stack Protection
CONFIG_STACK_SENTINEL=y   
CONFIG_STACK_CANARIES=y

###############################################################################
# v1.3.4: Shared Memory Pools (multi-heap with priorities)
###############################################################################
# Use Zephyr's shared multi-heap allocator to prevent subsystem starvation
# Each subsystem (BT, WiFi, etc) can allocate from shared pools
CONFIG_SHARED_MULTI_HEAP=y
# For memory profiling: shows which subsystems use most memory
CONFIG_SYS_HEAP_RUNTIME_STATS=y
# Dynamic memory pool allocation: allows pools to grow as needed
CONFIG_DYNAMIC_THREAD_ALLOC=y
# Enable memory profiling by default (v1.3.4)
CONFIG_AKIRA_MEMORY_PROFILE=y

###############################################################################
# Logging & Debug
###############################################################################
# Disable debug optimizations for runtime performance (5-10% faster)
CONFIG_DEBUG_OPTIMIZATIONS=n
CONFIG_LOG=y
# Level 0=OFF, 1=ERROR, 2=WARNING, 3=INFO, 4=DEBUG
# Set to 3 (INFO) to see initialization messages
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MAX_LEVEL=4
CONFIG_LOG_PRINTK=y    
CONFIG_DISPLAY_LOG_LEVEL_ERR=y

###############################################################################
# Console & Shell
###############################################################################
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_SHELL=y
CONFIG_SHELL_BACKENDS=y
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_PROMPT_UART="akira:~$ "
CONFIG_SHELL_CMD_BUFF_SIZE=96
CONFIG_SHELL_ARGC_MAX=6
CONFIG_SHELL_TAB=y
CONFIG_SHELL_TAB_AUTOCOMPLETION=y
CONFIG_SHELL_HISTORY=y
CONFIG_SHELL_HISTORY_BUFFER=64

###############################################################################
# Bluetooth (use CONFIG_AKIRA_BLUETOOTH=y in Kconfig for auto-deps)
###############################################################################
CONFIG_AKIRA_BLUETOOTH=y
CONFIG_BT_DEVICE_NAME="AkiraOS"
CONFIG_BT_MAX_CONN=1
# Reduce BT buffer sizes to save DRAM
# v1.3.4: PSRAM allocation strategy:
#   - WiFi buffers: CONFIG_ESP32_WIFI_NET_ALLOC_SPIRAM=y (board config)
#   - Fonts/Framebuffer: CONFIG_AKIRA_*_IN_PSRAM=y (board config)
#   - OCRE runtime: CONFIG_OCRE_WAMR_HEAP_BUFFER_IN_PSRAM=y (board config)
#   - BT buffers: Fixed size, kept in DRAM (Zephyr limitation)
# Boards without PSRAM will use DRAM for these allocations
CONFIG_BT_L2CAP_TX_MTU=128
CONFIG_BT_BUF_ACL_RX_SIZE=128
CONFIG_BT_BUF_ACL_TX_SIZE=128
CONFIG_BT_ATT_PREPARE_COUNT=1
# Increased stack sizes for HID support (prevent stack overflow)
CONFIG_BT_RX_STACK_SIZE=2048
CONFIG_BT_HCI_TX_STACK_SIZE=1024
CONFIG_BT_KEYS_OVERWRITE_OLDEST=y

# HID Subsystem
CONFIG_AKIRA_HID=y
CONFIG_AKIRA_HID_KEYBOARD=y
CONFIG_AKIRA_HID_GAMEPAD=y
CONFIG_AKIRA_BT_HID=y

###############################################################################
# Display & Input
###############################################################################
CONFIG_DISPLAY=y
CONFIG_INPUT=y
CONFIG_INPUT_GPIO_KEYS=y

###############################################################################
# Storage (use CONFIG_AKIRA_STORAGE=y in Kconfig for auto-deps)
###############################################################################
CONFIG_AKIRA_STORAGE=y
CONFIG_FILE_SYSTEM_SHELL=y
CONFIG_SETTINGS_FILE=y
CONFIG_SETTINGS_RUNTIME=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y
CONFIG_STREAM_FLASH=y

###############################################################################
# MCUboot / OTA
###############################################################################
CONFIG_BOOTLOADER_MCUBOOT=y
CONFIG_MCUBOOT_IMG_MANAGER=y      
CONFIG_IMG_MANAGER=y          
CONFIG_IMG_ENABLE_IMAGE_CHECK=y   
CONFIG_IMG_ERASE_PROGRESSIVELY=y  
CONFIG_MCUBOOT_SIGNATURE_KEY_FILE="" 

###############################################################################
# Cryptography
###############################################################################
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_BUILTIN=y
CONFIG_MBEDTLS_RSA_C=y
CONFIG_MBEDTLS_PKCS1_V15=y

###############################################################################
# POSIX / Misc
###############################################################################
CONFIG_POSIX_API=y
CONFIG_REBOOT=y               

###############################################################################
# OCRE Runtime Configuration
###############################################################################
CONFIG_OCRE=y
CONFIG_OCRE_WAMR_INTERPRETER=y
CONFIG_OCRE_DEFAULT_WORKING_DIRECTORY="/lfs/ocre"
CONFIG_OCRE_LOG_LEVEL=3
CONFIG_OCRE_WAMR_LOG_LEVEL=3
CONFIG_MAX_CONTAINERS=2

###############################################################################
# App Manager
###############################################################################
CONFIG_AKIRA_APP_MANAGER=y
CONFIG_AKIRA_APP_MAX_INSTALLED=4
CONFIG_AKIRA_APP_MAX_RUNNING=1
CONFIG_AKIRA_APP_SOURCE_BLE=y

###############################################################################
# OTA Manager
###############################################################################
CONFIG_AKIRA_OTA=y
CONFIG_AKIRA_OTA_BLE=y

###############################################################################
# Settings
###############################################################################
CONFIG_AKIRA_SETTINGS=y

###############################################################################
# v1.3.4: Optional API Modules
###############################################################################
CONFIG_AKIRA_RF_MODULE=y
CONFIG_AKIRA_SYSTEM_MODULE=y
###############################################################################
# v1.3.5: UI Framework
###############################################################################
# Enabled by default on display boards, disabled on headless.
# Saves 2-3KB of flash on boards without display.
CONFIG_AKIRA_UI=y