###############################################################################
# ESP32 Core
###############################################################################
CONFIG_SPI=y
CONFIG_GPIO=y
CONFIG_PINCTRL=y
CONFIG_I2C=y
# Minimal WiFi for OTA (re-enabled for NET_REQUEST_WIFI_* symbols)
CONFIG_WIFI=y
CONFIG_WIFI_ESP32=y
# Use Zephyr WiFi L2 network management
CONFIG_NET_L2_WIFI_MGMT=y
# Disabled SPIRAM / large heap options to keep footprint small
# CONFIG_ESP_WIFI_HEAP_SPIRAM is not set
# CONFIG_ESP32_WIFI_STA_AUTO_DHCPV4 is not set

# Enable multi-heap and shared multi-heap so components that rely on
# shared_multi_heap_* symbols (e.g., PSRAM helpers, third-party adapters)
# are linked in and do not cause undefined references at link time.
CONFIG_MULTI_HEAP=y
CONFIG_SHARED_MULTI_HEAP=y

CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y
CONFIG_STREAM_FLASH=y

###############################################################################
# Kernel & Threads
###############################################################################
# Reduced main/workqueue stack sizes to fit DRAM budget while keeping
# sufficient stack for core tasks. These were lowered after link-time
# DRAM overflow was detected.
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1024
CONFIG_IDLE_STACK_SIZE=512
CONFIG_DYNAMIC_THREAD=y
CONFIG_DYNAMIC_THREAD_ALLOC=y
CONFIG_KERNEL_MEM_POOL=y
CONFIG_HEAP_MEM_POOL_SIZE=131072
CONFIG_SYS_HEAP_RUNTIME_STATS=y
CONFIG_THREAD_MONITOR=y

# State Machine Framework (needed by OCRE)
CONFIG_SMF=y
CONFIG_SMF_ANCESTOR_SUPPORT=y
CONFIG_SMF_INITIAL_TRANSITION=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_STACK_INFO=y
CONFIG_STATS=y
CONFIG_STATS_NAMES=y
CONFIG_STACK_SENTINEL=y   
CONFIG_STACK_CANARIES=y   
###############################################################################
# Logging & Debug
###############################################################################
CONFIG_DEBUG_OPTIMIZATIONS=y
CONFIG_LOG=y
CONFIG_LOG_BUFFER_SIZE=512
CONFIG_LOG_DEFAULT_LEVEL=2
CONFIG_LOG_MAX_LEVEL=3
CONFIG_LOG_PRINTK=y    
CONFIG_DISPLAY_LOG_LEVEL_ERR=y

###############################################################################
# Console & Shell
###############################################################################
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_SHELL=y
CONFIG_SHELL_BACKENDS=y
CONFIG_SHELL_BACKEND_SERIAL=y
# Disable telnet backend on memory constrained boards
# CONFIG_SHELL_BACKEND_TELNET is not set
# CONFIG_SHELL_TELNET_SUPPORT_COMMAND is not set
CONFIG_SHELL_PROMPT_UART="akira:~$ "
CONFIG_SHELL_CMD_BUFF_SIZE=128
CONFIG_SHELL_ARGC_MAX=8
CONFIG_SHELL_TAB=y
CONFIG_SHELL_TAB_AUTOCOMPLETION=y
CONFIG_SHELL_HISTORY=y
CONFIG_SHELL_HISTORY_BUFFER=128


###############################################################################
# Networking
###############################################################################
CONFIG_NETWORKING=y 
CONFIG_NET_IPV4=y
CONFIG_NET_IPV6=n
CONFIG_NET_TCP=y
CONFIG_NET_UDP=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_OFFLOAD=y
CONFIG_NET_DHCPV4=y
CONFIG_NET_MAX_CONN=4
# Optimized for better throughput with acceptable memory usage
CONFIG_NET_TCP_MAX_SEND_WINDOW_SIZE=1024
CONFIG_NET_TCP_MAX_RECV_WINDOW_SIZE=1024
CONFIG_NET_TCP_TIME_WAIT_DELAY=0
CONFIG_NET_BUF_RX_COUNT=12
CONFIG_NET_BUF_TX_COUNT=10
CONFIG_NET_PKT_RX_COUNT=12
CONFIG_NET_PKT_TX_COUNT=10
CONFIG_NET_BUF_DATA_SIZE=256
CONFIG_NET_MGMT=y
CONFIG_NET_MGMT_EVENT=y
CONFIG_NET_MGMT_EVENT_INFO=y
CONFIG_NET_CONFIG_AUTO_INIT=n
CONFIG_NET_CONFIG_SETTINGS=y
CONFIG_NET_CONFIG_INIT_TIMEOUT=0

# Disable local HTTP server to save RAM on memory-constrained boards (we still keep HTTP client for OTA/app updates)
# CONFIG_HTTP_SERVER is not set
# CONFIG_HTTP_SERVER_MAX_STREAMS is not set
# CONFIG_HTTP_SERVER_STACK_SIZE is not set
# CONFIG_WEBSOCKET_CLIENT is not set

###############################################################################
# Bluetooth
###############################################################################
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="AkiraOS"
CONFIG_BT_MAX_CONN=1
CONFIG_BT_L2CAP_TX_MTU=200
CONFIG_BT_BUF_ACL_RX_SIZE=200
CONFIG_BT_BUF_ACL_TX_SIZE=200

# HID Subsystem
CONFIG_AKIRA_HID=y
CONFIG_AKIRA_HID_KEYBOARD=y
CONFIG_AKIRA_HID_GAMEPAD=y
CONFIG_AKIRA_BT_HID=y
# CONFIG_AKIRA_HID_SIM=n

# GATT
CONFIG_BT_GATT_CLIENT=y
CONFIG_BT_ATT_PREPARE_COUNT=1

# BT Work Queue Stack Sizes
CONFIG_BT_RX_STACK_SIZE=2048
CONFIG_BT_HCI_TX_STACK_SIZE=1024

# Security
CONFIG_BT_SMP=y
CONFIG_BT_SIGNING=y
CONFIG_BT_BONDABLE=y
CONFIG_BT_KEYS_OVERWRITE_OLDEST=y

# Device Information Service (optional - disable to save memory)
# CONFIG_BT_DIS=y
# CONFIG_BT_DIS_STR_MAX=21
# Battery Service (optional - disable to save memory)
# CONFIG_BT_BAS=y

###############################################################################
# Display & Input (disabled on constrained builds)
###############################################################################
# CONFIG_DISPLAY is not set
# CONFIG_MIPI_DBI is not set
# CONFIG_INPUT is not set
# CONFIG_INPUT_GPIO_KEYS is not set

###############################################################################
# File System & Settings (trimmed for constrained boards)
###############################################################################
CONFIG_FILE_SYSTEM=y
# Disable SDMMC to reduce memory usage; enable Elm-Fat (headers only) to satisfy ff.h includes
# CONFIG_DISK_ACCESS is not set
CONFIG_FAT_FILESYSTEM_ELM=y
# Keep long filename support disabled to save memory
# CONFIG_FS_FATFS_LFN is not set
# CONFIG_FS_FATFS_MAX_LFN is not set
# Set a single FAT mount point so ff.h and ff.c get a valid FF_VOLUMES
CONFIG_FS_FATFS_CUSTOM_MOUNT_POINT_COUNT=1
# Keep small on-device FS (LittleFS) only if needed by the app
CONFIG_FILE_SYSTEM_LITTLEFS=y
# Disable filesystem shell commands to save RAM
# CONFIG_FILE_SYSTEM_SHELL is not set
# Keep settings / NVS for OTA/app configuration
CONFIG_SETTINGS=y
CONFIG_SETTINGS_FILE=y
CONFIG_SETTINGS_RUNTIME=y
CONFIG_SETTINGS_NVS=y
CONFIG_NVS=y

###############################################################################
# SD Card Support (disabled on constrained builds)
###############################################################################
# CONFIG_DISK_DRIVERS is not set
# CONFIG_DISK_DRIVER_SDMMC is not set
CONFIG_SPI=y

###############################################################################
# MCUboot / OTA
###############################################################################
CONFIG_BOOTLOADER_MCUBOOT=y
# Enable MCUboot image manager    
CONFIG_MCUBOOT_IMG_MANAGER=y      
# Enable image management (upload, swap, etc.)
CONFIG_IMG_MANAGER=y          
# Enable image validation (signature, hash, etc.)    
CONFIG_IMG_ENABLE_IMAGE_CHECK=y   
# Erase flash sectors progressively during image write
CONFIG_IMG_ERASE_PROGRESSIVELY=y  

CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y


# Path to your public key file for verifying signed images
CONFIG_MCUBOOT_SIGNATURE_KEY_FILE="" 
###############################################################################
# Cryptography
###############################################################################
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_BUILTIN=y
CONFIG_MBEDTLS_RSA_C=y
CONFIG_MBEDTLS_PKCS1_V15=y
###############################################################################
# POSIX / Misc
###############################################################################
CONFIG_POSIX_API=y
CONFIG_REBOOT=y               
###############################################################################
# Flash configuration
###############################################################################
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y
CONFIG_ESPTOOLPY_FLASHMODE_DIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_40M=y

# OCRE container configuration
# Reduce max containers to save internal DRAM
CONFIG_MAX_CONTAINERS=3

# App Manager configuration  
CONFIG_AKIRA_APP_MANAGER=y
CONFIG_AKIRA_APP_MAX_INSTALLED=8
CONFIG_AKIRA_APP_MAX_RUNNING=2
CONFIG_AKIRA_APP_SOURCE_HTTP=y

# OTA Manager
CONFIG_AKIRA_OTA=y
CONFIG_AKIRA_OTA_HTTP=y

# Web Server (disabled for constrained boards)
# CONFIG_AKIRA_HTTP_SERVER is not set
