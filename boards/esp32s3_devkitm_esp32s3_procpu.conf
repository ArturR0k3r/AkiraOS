# ESP32-S3 Specific Configuration
# ESP32-S3 N16R8 Module: 16MB Flash, 8MB PSRAM (OPI)

###############################################################################
# PSRAM (External SPIRAM) Configuration - 8MB OPI PSRAM
###############################################################################
CONFIG_ESP_SPIRAM=y
CONFIG_ESP_SPIRAM_SIZE=8388608
CONFIG_ESP_SPIRAM_HEAP_SIZE=4194304
CONFIG_SPIRAM_MODE_OCT=y
CONFIG_SPIRAM_TYPE_ESPPSRAM64=y
CONFIG_SPIRAM_SPEED_80M=y

# Optional: Move read-only data to PSRAM to free internal DRAM
# CONFIG_SPIRAM_RODATA=y

# Skip PSRAM memtest for faster boot (enable for debugging)
CONFIG_ESP_SPIRAM_MEMTEST=n

###############################################################################
# Memory Configuration (with PSRAM)
###############################################################################
# Keep internal DRAM heap smaller - use PSRAM for large allocations
CONFIG_HEAP_MEM_POOL_SIZE=65536
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

# Shared Multi-Heap for PSRAM allocation
CONFIG_SHARED_MULTI_HEAP=y

###############################################################################
# ESP32-S3 WiFi/BT
###############################################################################
CONFIG_WIFI=y
CONFIG_ESP32_WIFI_STA_AUTO_DHCPV4=y

# SPI for display
CONFIG_SPI=y

# Sensor support
CONFIG_I2C=y
CONFIG_SENSOR=y

###############################################################################
# App Manager - Enabled with PSRAM support
###############################################################################
# With 8MB PSRAM, we can now enable App Manager
# OCRE runtime and WASM heaps will use PSRAM
CONFIG_AKIRA_APP_MANAGER=y

###############################################################################
# OCRE Memory Configuration - Optimized for ESP32-S3 with PSRAM
###############################################################################
# Reduce DRAM usage - these buffers go in internal RAM by default
# WAMR heap buffer - reduced from default 32KB to save DRAM
CONFIG_OCRE_WAMR_HEAP_BUFFER_SIZE=16384

# Container settings - keep reasonable for WASM apps
CONFIG_OCRE_CONTAINER_DEFAULT_STACK_SIZE=4096
CONFIG_OCRE_CONTAINER_DEFAULT_HEAP_SIZE=16384

# Limit max containers to save memory
CONFIG_MAX_CONTAINERS=4
