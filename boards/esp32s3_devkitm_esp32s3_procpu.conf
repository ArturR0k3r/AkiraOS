###############################################################################
# ESP32-S3 DevKitM Board Configuration
# ESP32-S3 N16R8 Module: 16MB Flash, 8MB PSRAM (OPI)
###############################################################################

###############################################################################
# PSRAM (External SPIRAM) - 8MB OPI PSRAM
###############################################################################
CONFIG_ESP_SPIRAM=y
# 8MB PSRAM = 8388608 bytes
CONFIG_ESP_SPIRAM_SIZE=8388608
CONFIG_ESP_SPIRAM_HEAP_SIZE=4194304
CONFIG_SPIRAM_MODE_OCT=y
CONFIG_SPIRAM_TYPE_ESPPSRAM64=y
# Note: ESP32-S3 only supports 40MHz SPIRAM speed
CONFIG_SPIRAM_SPEED_40M=y
CONFIG_MEMC=y
CONFIG_SHARED_MULTI_HEAP=y
# Skip memtest for faster boot
CONFIG_ESP_SPIRAM_MEMTEST=n

###############################################################################
# Memory Configuration (with PSRAM) - Keep DRAM usage low
###############################################################################
# Reduce internal DRAM heap - use PSRAM for large allocs
CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_MAIN_STACK_SIZE=2560
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1024
CONFIG_SHELL_STACK_SIZE=2560
# Reduce ISR stack and idle stack
CONFIG_ISR_STACK_SIZE=2048
CONFIG_IDLE_STACK_SIZE=256

###############################################################################
# WiFi - Enable with AKIRA_WIFI for auto-deps
###############################################################################
CONFIG_AKIRA_WIFI=y
CONFIG_WIFI_ESP32=y
CONFIG_ESP32_WIFI_STA_AUTO_DHCPV4=y
# Move WiFi/NET buffers to PSRAM to free DRAM
CONFIG_ESP32_WIFI_NET_ALLOC_SPIRAM=y
# Disable AMPDU to reduce memory
CONFIG_ESP32_WIFI_AMPDU_TX_ENABLED=n
CONFIG_ESP32_WIFI_AMPDU_RX_ENABLED=n

###############################################################################
# Network Buffer Configuration - reduced for low DRAM
###############################################################################
CONFIG_NET_BUF_DATA_SIZE=128
CONFIG_NET_PKT_RX_COUNT=6
CONFIG_NET_PKT_TX_COUNT=6
CONFIG_NET_BUF_RX_COUNT=12
CONFIG_NET_BUF_TX_COUNT=12
# Reduce TCP/UDP buffers
CONFIG_NET_TCP_RECV_QUEUE_TIMEOUT=200

###############################################################################
# SPI & I2C for peripherals
###############################################################################
CONFIG_SPI=y
CONFIG_I2C=y
CONFIG_SENSOR=y

###############################################################################
# Display
###############################################################################
CONFIG_MIPI_DBI=y

###############################################################################
# PSRAM Features
###############################################################################
CONFIG_AKIRA_FONTS_IN_PSRAM=y
CONFIG_AKIRA_FRAMEBUFFER_IN_PSRAM=y
CONFIG_OCRE_WAMR_HEAP_BUFFER_IN_PSRAM=y

###############################################################################
# OCRE Memory (with PSRAM - larger buffers)
###############################################################################
CONFIG_OCRE_WAMR_HEAP_BUFFER_SIZE=1048576
CONFIG_OCRE_CONTAINER_DEFAULT_STACK_SIZE=3072
CONFIG_OCRE_CONTAINER_DEFAULT_HEAP_SIZE=4096
CONFIG_MAX_CONTAINERS=4

###############################################################################
# ESP32-S3 Flash Configuration
###############################################################################
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y
CONFIG_ESPTOOLPY_FLASHMODE_DIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_40M=y

###############################################################################
# Logging - Immediate mode for debugging
###############################################################################
CONFIG_LOG_MODE_IMMEDIATE=y

###############################################################################
# Settings Backend (NVS for ESP32)
###############################################################################
CONFIG_SETTINGS_NVS=y

###############################################################################
# Optional Features (uncomment to enable)
###############################################################################
# CONFIG_AKIRA_HTTP_SERVER=y
# CONFIG_AKIRA_EMBEDDED_WEB=y
# CONFIG_SHELL_BACKEND_TELNET=y
# CONFIG_AKIRA_OTA_HTTP=y
