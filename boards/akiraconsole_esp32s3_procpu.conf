# Akira Console - ESP32-S3 Configuration
# ESP32-S3 MINI N4R2 Module: 4MB Flash, 2MB PSRAM (OPI)

###############################################################################
# PSRAM (External SPIRAM) Configuration - 2MB OPI PSRAM
###############################################################################
CONFIG_ESP_SPIRAM=y
CONFIG_ESP_SPIRAM_SIZE=2097152
CONFIG_ESP_SPIRAM_HEAP_SIZE=1048576
CONFIG_SPIRAM_MODE_OCT=y
CONFIG_AKIRA_PSRAM=y
CONFIG_SPIRAM_TYPE_ESPPSRAM16=y
CONFIG_SPIRAM_SPEED_80M=y

# Enable MEMC driver - REQUIRED for PSRAM configuration
CONFIG_MEMC=y

# Optional: Move read-only data to PSRAM to free internal DRAM 
CONFIG_SPIRAM_RODATA=n

# Skip PSRAM memtest for faster boot
CONFIG_ESP_SPIRAM_MEMTEST=n

###############################################################################
# Thread Local Storage - REQUIRED for ESP32-S3 WAMR
###############################################################################
CONFIG_THREAD_LOCAL_STORAGE=y

###############################################################################
# Memory Configuration (with PSRAM)
###############################################################################
CONFIG_HEAP_MEM_POOL_SIZE=65536
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048
CONFIG_SHELL_STACK_SIZE=4096

# Shared Multi-Heap for PSRAM allocation
CONFIG_SHARED_MULTI_HEAP=y

###############################################################################
# ESP32-S3 WiFi/BT
###############################################################################
CONFIG_WIFI=y
CONFIG_ESP32_WIFI_STA_AUTO_DHCPV4=y

# Bluetooth Controller Configuration
CONFIG_ESP32_BT_CONTROLLER_STACK_SIZE=4096
CONFIG_ESP32_BT_CONTROLLER_TASK_PRIO=2

# SPI for display
CONFIG_SPI=y

# Sensor support
CONFIG_I2C=y
CONFIG_SENSOR=y

# Disable AMPDU to reduce memory usage
CONFIG_ESP32_WIFI_AMPDU_TX_ENABLED=n
CONFIG_ESP32_WIFI_AMPDU_RX_ENABLED=n

###############################################################################
# Network Buffer Configuration
###############################################################################
CONFIG_NET_BUF_DATA_SIZE=128
CONFIG_NET_PKT_RX_COUNT=8
CONFIG_NET_PKT_TX_COUNT=8
CONFIG_NET_BUF_RX_COUNT=16
CONFIG_NET_BUF_TX_COUNT=16

###############################################################################
# App Manager - Enabled with PSRAM support
###############################################################################
CONFIG_AKIRA_APP_MANAGER=y

# Place large static assets into PSRAM where available
CONFIG_AKIRA_FONTS_IN_PSRAM=y
CONFIG_AKIRA_FRAMEBUFFER_IN_PSRAM=y

###############################################################################
# WAMR Memory Configuration - Using PSRAM
###############################################################################
CONFIG_WAMR_HEAP_SIZE=524288

# Limit max containers to save memory
CONFIG_MAX_CONTAINERS=4

###############################################################################
# Logging - Use immediate mode for debugging
###############################################################################
CONFIG_LOG_MODE_IMMEDIATE=y

CONFIG_AKIRA_BT_ECHO=y
CONFIG_AKIRA_EMBEDDED_WEB=y
CONFIG_UDC_DWC2_STACK_SIZE=4096
CONFIG_USBD_THREAD_STACK_SIZE=4096
