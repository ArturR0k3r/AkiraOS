# =============================================================================
# ESP32-S3 Super Mini Board Configuration for AkiraOS
# ESP32-S3 Mini N4R2: 4MB Flash, 2MB PSRAM (Quad SPI)
# =============================================================================
# MINIMAL CONFIG: BT, WiFi, and heavy subsystems DISABLED.
# Goal: get USB CDC ACM console working first, then re-enable features.
# =============================================================================

###############################################################################
# Flash Size Override (N4R2 = 4MB, prj.conf defaults to 16MB)
###############################################################################
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y
CONFIG_ESPTOOLPY_FLASHMODE_DIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_40M=y

###############################################################################
# PSRAM (External SPIRAM) - 2MB Quad SPI PSRAM
###############################################################################
CONFIG_ESP_SPIRAM=y
CONFIG_SPIRAM_TYPE_ESPPSRAM16=y
CONFIG_SPIRAM_MODE_QUAD=y
CONFIG_SPIRAM_SPEED_40M=y
CONFIG_ESP_SPIRAM_MEMTEST=n
CONFIG_MEMC=y

###############################################################################
# Thread Local Storage - REQUIRED for ESP32-S3
###############################################################################
CONFIG_THREAD_LOCAL_STORAGE=y

###############################################################################
# Memory Configuration
###############################################################################
CONFIG_HEAP_MEM_POOL_SIZE=32768
CONFIG_MAIN_STACK_SIZE=3072
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1536
CONFIG_SHELL_STACK_SIZE=3072

###############################################################################
# Disable WiFi, BT, Networking (save ~100KB+ DRAM)
###############################################################################
CONFIG_WIFI=n
CONFIG_BT=n
CONFIG_NETWORKING=n

###############################################################################
# Disable heavy subsystems to fit in DRAM
###############################################################################
# MCUboot / OTA - disable for now
CONFIG_BOOTLOADER_MCUBOOT=n
CONFIG_MCUBOOT_IMG_MANAGER=n
CONFIG_IMG_MANAGER=n
CONFIG_IMG_ENABLE_IMAGE_CHECK=n
CONFIG_IMG_ERASE_PROGRESSIVELY=n
CONFIG_STREAM_FLASH=n

# Crypto - disable (not needed without networking/OTA)
CONFIG_MBEDTLS=n
CONFIG_BASE64=n
CONFIG_ENTROPY_GENERATOR=n

# Display - disable for now
CONFIG_DISPLAY=n
CONFIG_MIPI_DBI=n

# FAT filesystem - disable (keep LittleFS only)
CONFIG_DISK_ACCESS=n
CONFIG_FAT_FILESYSTEM_ELM=n
CONFIG_DISK_DRIVERS=n

# POSIX - disable
CONFIG_POSIX_API=n

# WASM runtime - disable for minimal boot
CONFIG_AKIRA_WASM_RUNTIME=n
CONFIG_AKIRA_WASM_API=n
CONFIG_AKIRA_RUNTIME_CUSTOM=n
CONFIG_AKIRA_APP_MANAGER=n

# Websocket - disable
CONFIG_WEBSOCKET_CLIENT=n

# Shell backend telnet - disable (no network)
CONFIG_SHELL_BACKEND_TELNET=n

# Input - disable for now
CONFIG_INPUT=n
CONFIG_INPUT_GPIO_KEYS=n

# SMF - disable if not needed
# CONFIG_SMF=n

# Dynamic threads - disable
CONFIG_DYNAMIC_THREAD=n

# Disable features not needed for minimal boot
CONFIG_AKIRA_BT_HID=n
CONFIG_AKIRA_BT_SHELL=n
CONFIG_AKIRA_BT_ECHO=n
CONFIG_AKIRA_HTTP_SERVER=n
CONFIG_AKIRA_OTA=n
CONFIG_AKIRA_OTA_HTTP=n
CONFIG_AKIRA_EMBEDDED_WEB=n
CONFIG_AKIRA_USB_HID=n
CONFIG_AKIRA_HID=n
CONFIG_AKIRA_HID_KEYBOARD=n
CONFIG_AKIRA_HID_GAMEPAD=n
CONFIG_AKIRA_SETTINGS=n

###############################################################################
# Peripherals (keep minimal)
###############################################################################
CONFIG_SPI=y
CONFIG_I2C=y
CONFIG_GPIO=y

###############################################################################
# USB CDC ACM Console
###############################################################################
CONFIG_USBD_CDC_ACM_CLASS=y
CONFIG_UART_LINE_CTRL=y
CONFIG_UDC_DWC2_STACK_SIZE=4096
CONFIG_USBD_THREAD_STACK_SIZE=4096

###############################################################################
# Logging
###############################################################################
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_BUFFER_SIZE=256
CONFIG_LOG_DEFAULT_LEVEL=3

###############################################################################
# Reduce shell memory usage
###############################################################################
CONFIG_SHELL_HISTORY=n
CONFIG_SHELL_TAB=n
CONFIG_SHELL_TAB_AUTOCOMPLETION=n
CONFIG_SHELL_WILDCARD=n
CONFIG_SHELL_HELP=y
CONFIG_FILE_SYSTEM_SHELL=n